<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Apple Spotify Songs Downloader</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.3.min.js"
        integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
</head>

<body>
    <div class="container">
        <h1>Apple Spotify Songs Downloader</h1>
        <div class="input-group">
            <form action="#" onsubmit="searchSongs(); return false;" style="width:100%;" class="my-2">
                <div class="form-check flex">
                    <input class="form-check-input" type="radio" name="type" id="Apple" checked>
                    <label class="form-check-label" for="Apple">
                      Apple Music
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="type" id="Spotify">
                    <label class="form-check-label" for="Spotify">
                      Spotify
                    </label>
                  </div>
                <input type="search" class="form-control rounded" id="searchBox"
                    placeholder="https://music.apple.com/us/album/tumsa-koi-pyaara/1734862548?i=1734862549"
                    aria-label="Search" aria-describedby="search-addon" />
                <!-- <select id="bitrate" class="form-select my-2" aria-label="Default select example">
                    <option selected value="128">128 kbps</option>
                    <option value="192">192 kbps</option>
                    <option value="320">320 kbps</option>
                </select> -->
                <button type="button" class="mt-2 btn btn-primary" onclick="searchSongs()">Search</button>
            </form>
            <br>
            <span id="loading"></span>
            <div id="songshow"></div>
        </div>
        <script>
        const copy = (e) => {
            const copyLink = e.innerHTML;
            navigator.clipboard.writeText(copyLink);
            e.innerHTML = 'Link Copied..';
        }

        const searchSongs = () => {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('loading').innerHTML = 'Please wait....';
            const url = document.getElementById('searchBox').value;
            let targetUrl = '/api/applemusicdownloader/song';
            if (document.getElementById('Apple').checked) {
                targetUrl = '/api/applemusicdownloader/song';
            } else if (document.getElementById('Spotify').checked) {
                targetUrl = '/api/spotifymusicdownloader/song';
            }
            if(!url)
            {
                alert("Please Enter Url")
            }
            // Fetch API call
            fetch(targetUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ url })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const { link, thumb, track_name, artist, album } = data;
                    const htmlContent = `
                        <div>
                            <h2>${track_name} - ${artist}</h2>
                            <div class="row">
                                <div class="col-sm-12 col-md-5">
                                    <img style="max-width:300px;" src="${thumb}" alt="${album}" class="rounded img-thumbnail">
                                </div>
                                <div class="col-sm-12 col-md-7">
                                    <h3>${track_name}</h3>
                                    <p>${artist}</p>
                                    <p>${album}</p>
                                    <p><span style="color:green;" onclick="copy(this)">${thumb}</span></p>
                                    <p><span style="color:red;" id="link" onclick="copy(this)">${link}</span></p>
                                    <div class="my-1">
                                        <button onclick="window.location='${link}'" type="button" class="btn btn-dark btn-lg">Download</button>
                                    </div>
                                    <audio src="${link}" controls></audio>
                                </div>
                            </div>
                        </div>`;
                    document.getElementById('songshow').innerHTML = htmlContent;
                } else {
                    alert("Failed to fetch..");
                }
                document.getElementById('loading').style.display = 'none';
            })
            .catch(error => {
                console.error('Error:', error);
                alert("An error occurred.");
                document.getElementById('loading').style.display = 'none';
            });
        }
        </script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous">
        </script>
</body>

</html>
